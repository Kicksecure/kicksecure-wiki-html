<!DOCTYPE html>
<html class="client-nojs" dir="ltr" lang="en"><!-- 
 single html processed by https://github.com/zTrix/webpage2html
 title: Shrink Virtual Harddisk - Kicksecure
 url: ./Shrink_Virtual_Harddisk
-->
<head>
<meta charset="utf-8"/>
<title>Shrink Virtual Harddisk - Kicksecure</title>
<link rel=stylesheet type=text/css href=style.css>




<meta content="" name="ResourceLoaderDynamicStyles"/>

<meta content="MediaWiki 1.37.2" name="generator"/>
<meta content="telephone=no" name="format-detection"/>
<meta content="@Kicksecure" name="twitter:site"/>
<meta content="summary_large_image" name="twitter:card"/>
<meta content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0" name="viewport"/>
<link data-href="/w/index.php?title=Shrink_Virtual_Harddisk&amp;action=edit" href="https://www.kicksecure.com/w/index.php?title=Shrink_Virtual_Harddisk&amp;action=edit" rel="alternate.html" title="Edit" type="application/x-wiki"/>
<link data-href="/w/index.php?title=Shrink_Virtual_Harddisk&amp;action=edit" href="https://www.kicksecure.com/w/index.php?title=Shrink_Virtual_Harddisk&amp;action=edit" rel="edit.html" title="Edit"/>
<link data-href="/w/images/4/45/Kicksecure-home-favicon.ico" href="data:image/x-icon;base64,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" rel="shortcut icon"/>
<link data-href="/w/opensearch_desc.php" href="https://www.kicksecure.com/w/opensearch_desc.php" rel="search.html" title="Kicksecure (en)" type="application/opensearchdescription+xml"/>
<link data-href="https://www.kicksecure.com/w/api.php?action=rsd" href="https://www.kicksecure.com/w/api.php?action=rsd" rel="EditURI" type="application/rsd+xml"/>
<link data-href="/wiki/WgRightsPage" href="./WgRightsPage" rel="license"/>
<link data-href="/w/index.php?title=Special:RecentChanges&amp;feed=atom" href="https://www.kicksecure.com/w/index.php?title=Special:RecentChanges&amp;feed=atom" rel="alternate.html" title="Kicksecure Atom feed" type="application/atom+xml"/>
<noscript></noscript>

<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="Shrink Virtual Harddisk" property="og:title"/>
<meta content="Kicksecure" property="og:site_name"/>
<meta content="./Shrink_Virtual_Harddisk" property="og:url"/>
<meta content="/w/images/thumb/f/fc/Kicksecure-twitter-post.jpg/470px-Kicksecure-twitter-post.jpg" property="og:image"/>
<meta content="2022-04-19T09:22:08Z" property="article:modified_time"/>
<meta content="2022-04-19T09:22:08Z" property="article:published_time"/>

</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject mw-editable page-Shrink_Virtual_Harddisk rootpage-Shrink_Virtual_Harddisk skin-vector action-view skin--responsive skin-vector-legacy"><div class="noprint" id="mw-page-base"></div>
<div class="noprint" id="mw-head-base"></div>
<div class="mw-body" id="content" role="main">
<a id="top"></a>
<div id="siteNotice"><div id="mw-dismissablenotice-anonplace"></div></div>
<div class="mw-indicators">
</div>
<h1 class="firstHeading" id="firstHeading">Shrink Virtual Harddisk</h1>
<div class="vector-body" id="bodyContent">
<div class="noprint" id="siteSub">From Kicksecure</div>
<div id="contentSub"></div>
<div id="contentSub2"></div>
<div id="jump-to-nav"></div>
<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
<a class="mw-jump-link" href="#searchInput">Jump to search</a>
<div class="mw-body-content mw-content-ltr" dir="ltr" id="mw-content-text" lang="en"><div class="mw-parser-output"><p>Over the course of many system upgrades, logging, etc. the image files can grow substantially. Deletion of obsolete files does not automatically shrink the disk size back as it has “grown” to accommodate the data needed.
</p><p>A tool called zerofree free is needed to shrink the backing virtual disk file. Since the default are ext4 partitions, the process might be bit involved:
</p><p><br/>
1.   Install the package <code>zerofree</code> in the virtual machine you want to shrink.
</p><p>2.   Erase what you need in the VM, run apt-get purge, apt-get autoremove, apt-get clean, etc. as needed.
</p><p>3.   Reboot your virtual machine in recovery mode.
</p><p>4.   At the command prompt, type 
</p><div class="code-select">systemctl stop systemd-journald.socket &amp;&amp; systemctl stop systemd-journald.service &amp;&amp; mount -o remount,ro / &amp;&amp; zerofree -v /dev/vda1 &amp;&amp; shutdown now</div>
<p>5.   When the VM shuts down, open a terminal on your host.
</p><p>6.   Switch to root.
</p><div class="code-select">sudo -s</div>
<p></p><div class="code-select">cd /var/lib/libvirt/images</div>
<p>7.   Create a back up of the disk you want to shrink. 
</p><div class="code-select">mv YourVirtualMachineDisk.qcow2 YourVirtualMachineDisk.qcow2.backup</div>
<p>8.   Shrink the disk. 
</p><div class="code-select">qemu-img convert -o qcow2 -p YourVirtualMachineDisk.qcow2.backup YourVirtualMachineDisk.qcow2</div>
<p>9.   Boot up the VM and see if it is working. If it is, you can delete the backup of the qcow file.
</p><p><br/>
There are ways you can get more creative with this using thin provisioned images that are based on a static qcow2 backing file, a preferred method. However the above is a basic method for getting a shrunken qcow2 disk file.<sup class="reference" id="cite_ref-1"><a href="#cite_note-1">[1]</a></sup>
</p>
<div class="mw-references-wrap"><ol class="references">
<li id="cite_note-1"><span class="mw-cite-backlink"><a href="#cite_ref-1">↑</a></span> <span class="reference-text">Credit goes to forum user tempest <a class="external free" data-href="https://forums.whonix.org/t/is-it-possible-to-re-shrink-the-qcow2-image-files/13228/3p" href="https://forums.whonix.org/t/is-it-possible-to-re-shrink-the-qcow2-image-files/13228/3p" rel="noreferrer noopener" target="_blank">https://forums.whonix.org/t/is-it-possible-to-re-shrink-the-qcow2-image-files/13228/3p</a><sup class="ext-link-to-archive.html" title="Link to archived version"><a data-href="https://web.archive.org/web/https://forums.whonix.org/t/is-it-possible-to-re-shrink-the-qcow2-image-files/13228/3p" href="https://web.archive.org/web/https://forums.whonix.org/t/is-it-possible-to-re-shrink-the-qcow2-image-files/13228/3p" rel="noreferrer noopener" target="_blank"><img data-src="/w/images/7/73/Internet_Archive_logo.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAoCAYAAAB0HkOaAAACjUlEQVRYhc2YPW8TQRCGH39BfIZgGwICBEh8lkiUQElLgQQdoqJJRZm/EDqgowWJgoKGgoLfQAkIhUgoDcTYkIg4FsZgir3Ds3tzez7b5DLSyrvz7M28O3de77nE5FYCrgCLwF1gHvgMdKeImclqwHXgcZh4qLS3wDJwFSjMWsBp4B7wGviZICCptYAnwC1M5TJbGbOqZeB9xuS+1gsXtARc8AlYAO4Az4HNGQrwtVXgIXANqERC5oA3OyRAa3+AmzB6wOrAGV/p/qP1gHdSTAXYm5OYIc52sER+t+mfkHL4uQmszXK5GWw7p7x+kztkGTgLNIABsI5drULIm+G4A3x04h0GjgMBsAF8wn4eGsAJYD/wI4y/oQm7Qfx+1gW/pPCLTgx3k7zv8JcOfyFhUfQXFIGHMnAwlfFxN4bFi0lA8aXxEnYlAQ5mGRc9E7OKaTrxtGu8Y3lxQ0kmfe6qx+FN0S8CBzzcElNTgtVSeCD6+1J4QPx8Uwb2jCsmSOHSF0zALf+0lZmWW34pZpKVSV5V+JzIofFEMSVl4rS8wOg50bgVQwYbKhOHU3LpT+O7V0xfmdjPwH8pfCCSadzySzHay1dP9LVzRzeFb6dwy1/UnBMm0xaTxi2/FLOVEkzj3YT+uDx6n4qJ6SiT26L/TeGdhL52fR9zoJL2HfitiWkTt68Jfc3XJv6NcWN6x2li2hn4gPgR0l2AdyzFtJRkcvJ6CtdiZOLyJ70KnAOOYR6qFuZMG1kFOA8cxdyOL8AHTEUiO4k5cM9jqraCXa0jmH816qF/VRG4OyyqzGXgWY46FoFX0RtlFTiVo5gajF5v14BH+WlhJcfcuhWAB8DtvIUAT8uYLVrbXXfatv4CWncb4zb4QjwAAAAASUVORK5CYII="/></a></sup></span>
</li>
</ol></div>
<!-- Saved in parser cache with key www.kicksecure.com:stable-pcache:idhash:3356-0!canonicalwww.kicksecure.com and timestamp 20220421012942 and revision id 56090. Serialized with JSON.
 -->
</div>
<div class="printfooter">Retrieved from "<a data-href="https://www.kicksecure.com/w/index.php?title=Shrink_Virtual_Harddisk&amp;oldid=56090" dir="ltr" href="https://www.kicksecure.com/w/index.php?title=Shrink_Virtual_Harddisk&amp;oldid=56090">https://www.kicksecure.com/w/index.php?title=Shrink_Virtual_Harddisk&amp;oldid=56090</a>"</div></div>
<div class="catlinks catlinks-allhidden" data-mw="interface" id="catlinks"></div>
</div>
</div>
<div id="mw-data-after-content">
<div class="mw-cookiewarning-container"><div class="mw-cookiewarning-text"><span>By using our website, you acknowledge that you have read, understood and agreed to our Privacy Policy, Cookie Policy, Terms of Service, and E-Sign Consent.</span></div><form method="POST"><div class="oo-ui-layout oo-ui-horizontalLayout"><span aria-disabled="false" class="oo-ui-widget oo-ui-widget-enabled oo-ui-buttonElement oo-ui-buttonElement-framed oo-ui-labelElement oo-ui-flaggedElement-progressive oo-ui-buttonWidget"><a aria-disabled="false" class="oo-ui-buttonElement-button" data-href="/wiki/Terms_of_Service" href="./Terms_of_Service" rel="nofollow" role="button" tabindex="0"><span class="oo-ui-iconElement-icon oo-ui-iconElement-noIcon oo-ui-image-progressive"></span><span class="oo-ui-labelElement-label">More information</span><span class="oo-ui-indicatorElement-indicator oo-ui-indicatorElement-noIndicator oo-ui-image-progressive"></span></a></span><span aria-disabled="false" class="oo-ui-widget oo-ui-widget-enabled oo-ui-inputWidget oo-ui-buttonElement oo-ui-buttonElement-framed oo-ui-labelElement oo-ui-flaggedElement-primary oo-ui-flaggedElement-progressive oo-ui-buttonInputWidget"><button aria-disabled="false" class="oo-ui-inputWidget-input oo-ui-buttonElement-button" name="disablecookiewarning" tabindex="0" type="submit" value="OK"><span class="oo-ui-iconElement-icon oo-ui-iconElement-noIcon oo-ui-image-invert"></span><span class="oo-ui-labelElement-label">OK</span><span class="oo-ui-indicatorElement-indicator oo-ui-indicatorElement-noIndicator oo-ui-image-invert"></span></button></span></div></form></div>
</div>
<div id="mw-navigation">
<h2>Navigation menu</h2>
<div id="mw-head">

<div id="left-navigation">


</div>
<div id="right-navigation">


<div class="vector-search-box" id="p-search" role="search">
<div>
<h3>
<label for="searchInput">Search</label>
</h3>
<form action="/w/index.php" id="searchform">
<div data-search-loc="header-navigation" id="simpleSearch">
<input accesskey="f" autocapitalize="sentences" id="searchInput" name="search" placeholder="Search Kicksecure.html" title="Search Kicksecure [f]" type="search"/>
<input name="title" type="hidden" value="Special:Search"/>
<input class="searchButton mw-fallbackSearchButton" id="mw-searchButton" name="fulltext.html" title="Search the pages for this text" type="submit" value="Search"/>
<input class="searchButton" id="searchButton" name="go.html" title="Go to a page with this exact name if it exists" type="submit" value="Go"/>
</div>
</form>
</div>
</div>
</div>
</div>
<div id="mw-panel">
<div id="p-logo" role="banner">
<a class="mw-wiki-logo" data-href="/wiki/Main_Page" href="./Main_Page.html" title="Visit the main page"></a>
</div>


</div>
</div>
<footer class="mw-footer" id="footer" role="contentinfo">
<ul id="footer-info">
<li id="footer-info-lastmod"> </li>
<li id="footer-info-copyright">By using this website, you acknowledge you have read, understood, and agree to be bound by these these agreements:</li>
</ul>
<ul id="footer-places">
<li id="footer-places-Terms of Service"><a data-href="/wiki/Terms_of_Service" href="./Terms_of_Service.html" title="Terms of Service">Terms of Service</a></li>
<li id="footer-places-Privacy Policy"><a data-href="/wiki/Privacy_Policy" href="./Privacy_Policy.html" title="Privacy Policy">Privacy Policy</a></li>
<li id="footer-places-Cookie Policy"><a data-href="/wiki/Cookie_Policy" href="./Cookie_Policy.html" title="Cookie Policy">Cookie Policy</a></li>
<li id="footer-places-E-Sign_Consent"><a data-href="/wiki/E-Sign_Consent" href="./E-Sign_Consent.html" title="E-Sign Consent">E-Sign Consent</a></li>
<li id="footer-places-DMCA"><a class="mw-redirect" data-href="/wiki/DMCA" href="./DMCA.html" title="DMCA">DMCA</a></li>
<li id="footer-places-Imprint"><a data-href="/wiki/Imprint" href="./Imprint.html" title="Imprint">Imprint</a></li>
</ul>
</footer>

</body></html>